<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SWIFT OSINT Console</title>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        --bg: #05070e;
        --bg-elevated: #0a0f1e;
        --panel: rgba(15, 23, 42, 0.7);
        --card: #0b1220;
        --muted: #7a8aa3;
        --text: #e2e8f0;
        --accent: #4ad7ff;
        --accent-2: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --border: #1f2a44;
        --glow: rgba(74, 215, 255, 0.2);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
        background: radial-gradient(circle at top, #0a1427 0%, #05070e 55%, #05070e 100%);
        color: var(--text);
        min-height: 100vh;
      }

      .shell {
        display: grid;
        grid-template-columns: 260px 1fr;
        min-height: 100vh;
      }

      aside {
        background: #070b16;
        border-right: 1px solid var(--border);
        padding: 28px 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        letter-spacing: 0.4px;
      }

      .brand i {
        font-size: 22px;
        color: var(--accent);
      }

      .nav-section {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .nav-title {
        text-transform: uppercase;
        font-size: 11px;
        color: var(--muted);
        letter-spacing: 1px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 10px;
        color: var(--text);
        background: rgba(15, 23, 42, 0.45);
        border: 1px solid rgba(31, 42, 68, 0.6);
      }

      .nav-item i {
        color: var(--accent);
      }

      header {
        padding: 24px 28px 18px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(10, 15, 30, 0.95) 0%, rgba(10, 15, 30, 0.6) 100%);
      }

      header h1 {
        margin: 0;
        font-size: 26px;
        letter-spacing: 0.3px;
      }

      header p {
        margin: 6px 0 0;
        color: var(--muted);
      }

      .header-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 14px;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 999px;
        background: rgba(8, 14, 28, 0.7);
        border: 1px solid var(--border);
        font-size: 12px;
        color: var(--muted);
      }

      .badge i {
        color: var(--accent);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--warning);
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.6);
      }

      main {
        padding: 24px 28px 40px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 18px;
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 18px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        box-shadow: 0 0 0 1px rgba(74, 215, 255, 0.06), 0 20px 35px rgba(2, 6, 23, 0.5);
        backdrop-filter: blur(12px);
      }

      .card h2 {
        margin: 0;
        font-size: 17px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .card h2 i {
        color: var(--accent);
      }

      .card small {
        color: var(--muted);
      }

      .row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 10px;
      }

      label {
        font-size: 12px;
        color: var(--muted);
        display: block;
        margin-bottom: 6px;
      }

      input, select, textarea {
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(31, 42, 68, 0.8);
        background: var(--card);
        color: var(--text);
        font-size: 13px;
        outline: none;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      input:focus, select:focus, textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--glow);
      }

      textarea {
        min-height: 90px;
        resize: vertical;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }

      button {
        border: none;
        padding: 10px 14px;
        border-radius: 12px;
        background: var(--accent);
        color: #031018;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
        box-shadow: 0 12px 20px rgba(74, 215, 255, 0.2);
      }

      button:hover {
        transform: translateY(-1px);
      }

      button.secondary {
        background: #1f2937;
        color: var(--text);
        box-shadow: none;
      }

      button.success {
        background: var(--accent-2);
        color: #062312;
      }

      button.danger {
        background: var(--danger);
        color: #fff;
        box-shadow: none;
      }

      .response {
        background: rgba(5, 10, 20, 0.7);
        border: 1px dashed rgba(74, 215, 255, 0.25);
        border-radius: 12px;
        padding: 12px;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 12px;
        max-height: 280px;
        overflow: auto;
        white-space: pre-wrap;
      }

      .grid-span {
        grid-column: span 2;
      }

      footer {
        padding: 18px 28px 30px;
        color: var(--muted);
        font-size: 12px;
        border-top: 1px solid var(--border);
        background: rgba(8, 12, 24, 0.8);
      }

      @media (max-width: 1100px) {
        .shell {
          grid-template-columns: 1fr;
        }

        aside {
          flex-direction: row;
          flex-wrap: wrap;
          gap: 12px;
          align-items: center;
        }

        .nav-section {
          flex-direction: row;
          flex-wrap: wrap;
        }
      }

      @media (max-width: 900px) {
        .grid-span {
          grid-column: span 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <aside>
        <div class="brand">
          <i class="ri-shield-keyhole-line"></i>
          <span>SWIFT OSINT Console</span>
        </div>
        <div class="nav-section">
          <div class="nav-title">Operations</div>
          <div class="nav-item"><i class="ri-dashboard-2-line"></i>Mission Control</div>
          <div class="nav-item"><i class="ri-radar-line"></i>Ingestion Telemetry</div>
          <div class="nav-item"><i class="ri-database-2-line"></i>Evidence Store</div>
        </div>
        <div class="nav-section">
          <div class="nav-title">Security</div>
          <div class="nav-item"><i class="ri-lock-2-line"></i>Access Policies</div>
          <div class="nav-item"><i class="ri-shield-check-line"></i>Audit Trails</div>
        </div>
      </aside>

      <div>
        <header>
          <h1>SWIFT OSINT Dashboard</h1>
          <p>Operational testing, endpoint monitoring, and evidence validation workspace.</p>
          <div class="header-actions">
            <div class="badge" id="api-base"><i class="ri-link"></i> Base URL: <strong></strong></div>
            <div class="badge"><span class="status-dot" id="health-dot"></span> Health: <span id="health-label">unknown</span></div>
            <div class="badge"><i class="ri-time-line"></i> Live telemetry</div>
          </div>
        </header>

        <main>
          <section class="card">
            <h2><i class="ri-heart-pulse-line"></i>Health & Info</h2>
            <small>Quick checks for API availability.</small>
            <div class="row">
              <button id="btn-health"><i class="ri-pulse-line"></i>Check /health</button>
              <button id="btn-root" class="secondary"><i class="ri-home-4-line"></i>Get /</button>
            </div>
            <div class="response" id="health-response">Run a check to see response.</div>
          </section>

          <section class="card">
            <h2><i class="ri-database-line"></i>Sources</h2>
            <small>Available ingestion data sources.</small>
            <button id="btn-sources" class="secondary"><i class="ri-stack-line"></i>GET /ingestion/sources</button>
            <div class="response" id="sources-response">No data yet.</div>
          </section>

          <section class="card grid-span">
            <h2><i class="ri-add-circle-line"></i>Create Ingestion Job</h2>
            <small>POST /ingestion/jobs</small>
            <div class="row">
              <div>
                <label for="job-source">Source Type</label>
                <select id="job-source">
                  <option value="opencorporates">opencorporates</option>
                  <option value="news_api">news_api</option>
                </select>
              </div>
              <div>
                <label for="job-case">Case ID (optional)</label>
                <input id="job-case" placeholder="UUID (optional)" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="job-params">Parameters (JSON)</label>
                <textarea id="job-params"></textarea>
              </div>
              <div>
                <label for="job-meta">Metadata (JSON)</label>
                <textarea id="job-meta">{
  "analyst": "tester",
  "priority": "high"
}</textarea>
              </div>
            </div>
            <div class="row">
              <button id="btn-create" class="success"><i class="ri-send-plane-line"></i>Create Job</button>
              <button id="btn-clear-create" class="secondary"><i class="ri-eraser-line"></i>Clear</button>
            </div>
            <div class="response" id="create-response">No job created yet.</div>
          </section>

          <section class="card">
            <h2><i class="ri-list-check-3"></i>List Jobs</h2>
            <small>GET /ingestion/jobs</small>
            <div class="row">
              <div>
                <label for="filter-status">Status</label>
                <input id="filter-status" placeholder="pending / success / failed" />
              </div>
              <div>
                <label for="filter-source">Source</label>
                <input id="filter-source" placeholder="opencorporates" />
              </div>
              <div>
                <label for="filter-case">Case ID</label>
                <input id="filter-case" placeholder="UUID" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="filter-limit">Limit</label>
                <input id="filter-limit" type="number" min="1" value="25" />
              </div>
              <div>
                <label for="filter-offset">Offset</label>
                <input id="filter-offset" type="number" min="0" value="0" />
              </div>
            </div>
            <button id="btn-list"><i class="ri-search-eye-line"></i>Fetch Jobs</button>
            <div class="response" id="list-response">No jobs fetched yet.</div>
          </section>

          <section class="card">
            <h2><i class="ri-file-search-line"></i>Get Job</h2>
            <small>GET /ingestion/jobs/{job_id}</small>
            <label for="job-id">Job ID</label>
            <input id="job-id" placeholder="UUID" />
            <button id="btn-get-job" class="secondary"><i class="ri-search-line"></i>Fetch Job</button>
            <div class="response" id="job-response">Waiting for job ID.</div>
          </section>

          <section class="card">
            <h2><i class="ri-bar-chart-2-line"></i>Job Stats</h2>
            <small>GET /ingestion/jobs/{job_id}/stats</small>
            <label for="stats-id">Job ID</label>
            <input id="stats-id" placeholder="UUID" />
            <button id="btn-stats" class="secondary"><i class="ri-bar-chart-grouped-line"></i>Fetch Stats</button>
            <div class="response" id="stats-response">Waiting for stats.</div>
          </section>
        </main>

        <footer>
          Built for secure OSINT validation workflows. Responses show HTTP status, timing, and payload.
        </footer>
      </div>
    </div>

    <script>
      const baseUrl = window.location.origin;
      const setBadge = (text) => {
        document.querySelector("#api-base strong").textContent = text;
      };

      const pretty = (value) => JSON.stringify(value, null, 2);
      const updateResponse = (id, status, elapsed, data, error) => {
        const target = document.getElementById(id);
        const payload = error ? { error } : data;
        target.textContent = `[${status}] ${elapsed} ms\n${pretty(payload)}`;
      };

      const request = async (method, path, body) => {
        const started = performance.now();
        const options = { method, headers: { "Content-Type": "application/json" } };
        if (body) {
          options.body = JSON.stringify(body);
        }
        const response = await fetch(path, options);
        const elapsed = Math.round(performance.now() - started);
        const text = await response.text();
        let data = text;
        try {
          data = text ? JSON.parse(text) : null;
        } catch (err) {
          data = { raw: text };
        }
        return { status: response.status, elapsed, data, ok: response.ok };
      };

      const safeJson = (value) => {
        if (!value) return {};
        try {
          return JSON.parse(value);
        } catch (err) {
          throw new Error("Invalid JSON input.");
        }
      };

      const PARAM_TEMPLATES = {
        opencorporates: {
          company_name: "Tesla Inc",
          jurisdiction_code: "us_de"
        },
        news_api: {
          endpoint: "top-headlines",
          query: "Tesla OR Elon Musk",
          country: "us",
          language: "en",
          sort_by: "relevancy",
          page_size: 20,
          max_articles: 25
        }
      };

      const syncParamsTemplate = () => {
        const source = document.getElementById("job-source").value;
        const template = PARAM_TEMPLATES[source] || {};
        document.getElementById("job-params").value = JSON.stringify(template, null, 2);
      };

      document.getElementById("btn-health").addEventListener("click", async () => {
        const dot = document.getElementById("health-dot");
        const label = document.getElementById("health-label");
        try {
          const res = await request("GET", "/health");
          updateResponse("health-response", res.status, res.elapsed, res.data);
          if (res.ok) {
            dot.style.background = "#22c55e";
            label.textContent = "healthy";
          } else {
            dot.style.background = "#ef4444";
            label.textContent = "error";
          }
        } catch (err) {
          updateResponse("health-response", "ERR", "-", null, err.message);
          dot.style.background = "#ef4444";
          label.textContent = "error";
        }
      });

      document.getElementById("btn-root").addEventListener("click", async () => {
        try {
          const res = await request("GET", "/");
          updateResponse("health-response", res.status, res.elapsed, res.data);
        } catch (err) {
          updateResponse("health-response", "ERR", "-", null, err.message);
        }
      });

      document.getElementById("btn-sources").addEventListener("click", async () => {
        try {
          const res = await request("GET", "/ingestion/sources");
          updateResponse("sources-response", res.status, res.elapsed, res.data);
        } catch (err) {
          updateResponse("sources-response", "ERR", "-", null, err.message);
        }
      });

      document.getElementById("btn-create").addEventListener("click", async () => {
        try {
          const sourceType = document.getElementById("job-source").value;
          const caseId = document.getElementById("job-case").value.trim();
          const parameters = safeJson(document.getElementById("job-params").value);
          const metadata = safeJson(document.getElementById("job-meta").value);
          if (sourceType === "news_api") {
            const endpoint = parameters.endpoint || "everything";
            if (endpoint === "everything" && !parameters.query) {
              updateResponse("create-response", "ERR", "-", null, "news_api 'everything' requires a 'query' field.");
              return;
            }
            if (endpoint === "top-headlines") {
              const hasScope = parameters.country || parameters.category || parameters.sources || parameters.query;
              if (!hasScope) {
                updateResponse("create-response", "ERR", "-", null, "news_api 'top-headlines' requires country, category, sources, or query.");
                return;
              }
            }
          }
          if (sourceType === "opencorporates" && !parameters.company_name) {
            updateResponse("create-response", "ERR", "-", null, "opencorporates requires a 'company_name' field.");
            return;
          }
          const payload = {
            source_type: sourceType,
            parameters,
            metadata
          };
          if (caseId) {
            payload.case_id = caseId;
          }
          const res = await request("POST", "/ingestion/jobs", payload);
          updateResponse("create-response", res.status, res.elapsed, res.data);
          if (res.ok && res.data && res.data.id) {
            document.getElementById("job-id").value = res.data.id;
            document.getElementById("stats-id").value = res.data.id;
          }
        } catch (err) {
          updateResponse("create-response", "ERR", "-", null, err.message);
        }
      });

      document.getElementById("btn-clear-create").addEventListener("click", () => {
        document.getElementById("job-case").value = "";
        syncParamsTemplate();
        document.getElementById("job-meta").value = "{}";
        document.getElementById("create-response").textContent = "No job created yet.";
      });

      document.getElementById("btn-list").addEventListener("click", async () => {
        const params = new URLSearchParams();
        const status = document.getElementById("filter-status").value.trim();
        const source = document.getElementById("filter-source").value.trim();
        const caseId = document.getElementById("filter-case").value.trim();
        const limit = document.getElementById("filter-limit").value;
        const offset = document.getElementById("filter-offset").value;
        if (status) params.set("status", status);
        if (source) params.set("source_type", source);
        if (caseId) params.set("case_id", caseId);
        if (limit) params.set("limit", limit);
        if (offset) params.set("offset", offset);
        const path = `/ingestion/jobs${params.toString() ? "?" + params.toString() : ""}`;
        try {
          const res = await request("GET", path);
          updateResponse("list-response", res.status, res.elapsed, res.data);
        } catch (err) {
          updateResponse("list-response", "ERR", "-", null, err.message);
        }
      });

      document.getElementById("btn-get-job").addEventListener("click", async () => {
        const id = document.getElementById("job-id").value.trim();
        if (!id) {
          updateResponse("job-response", "ERR", "-", null, "Job ID is required.");
          return;
        }
        try {
          const res = await request("GET", `/ingestion/jobs/${id}`);
          updateResponse("job-response", res.status, res.elapsed, res.data);
        } catch (err) {
          updateResponse("job-response", "ERR", "-", null, err.message);
        }
      });

      document.getElementById("btn-stats").addEventListener("click", async () => {
        const id = document.getElementById("stats-id").value.trim();
        if (!id) {
          updateResponse("stats-response", "ERR", "-", null, "Job ID is required.");
          return;
        }
        try {
          const res = await request("GET", `/ingestion/jobs/${id}/stats`);
          updateResponse("stats-response", res.status, res.elapsed, res.data);
        } catch (err) {
          updateResponse("stats-response", "ERR", "-", null, err.message);
        }
      });

      setBadge(baseUrl);
      document.getElementById("job-source").addEventListener("change", syncParamsTemplate);
      syncParamsTemplate();
    </script>
  </body>
</html>
